var fs = require('fs')
var path = require('path')

module.exports = advance;

function advance(options = {
  withDir: false,
  maxDepth: null
}) {
  function read(root, filter, files, prefix, depth = 0) {
    prefix = prefix || ''
    files = files || []
    filter = filter || (x => x[0] !== '.')
    if (options.maxDepth != null && depth > options.maxDepth) {
      return
    }

    var dir = path.join(root, prefix)
    if (!fs.existsSync(dir)) return files
    if (fs.statSync(dir).isDirectory()) {
      depth++
      options.withDir && files.push(prefix)
      fs.readdirSync(dir)
      .filter(function (name, index) {
        return filter(name, index, dir)
      })
      .forEach(function (name) {
        read(root, filter, files, path.join(prefix, name), depth)
      })
    } else {
      files.push(prefix)
    }

    return files
  }
  return read;
}



